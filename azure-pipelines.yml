pool:
  # vmImage: 'ubuntu-16.04'
  vmImage: 'vs2017-win2016'
  # vmImage: 'win1803'

steps:
- powershell: |
    echo "about to pull"
    # docker build -f Dockerfile -t registry.gitlab.com/iain2/containerz:nanohello .
    docker pull microsoft/windowsservercore@sha256:c60a7376f5147e40b65c51fce34ac17710742f97e91b5c3a71e1667e671112f1

    echo "about to tag"
    docker tag microsoft/windowsservercore@sha256:c60a7376f5147e40b65c51fce34ac17710742f97e91b5c3a71e1667e671112f1 registry.gitlab.com/iain2/containerz:nanohello
    
    echo "about to login"
    # echo $env:AUTH | docker login -u iain2 --password-stdin registry.gitlab.com
    docker login -u iain2 -p $env:AUTH registry.gitlab.com    
    
    echo "about to push"
    docker push registry.gitlab.com/iain2/containerz:nanohello
    
    echo "yaml pipeline done"
  env:
    AUTH: $(auth)

